(()=>{"use strict";const e=document.querySelector("[data-lists]"),t=document.querySelector("[data-new-project-form]"),a=document.querySelector("[data-new-project-input]"),n=document.querySelector("[data-delete-list-button]"),d=document.querySelector("[data-project-display-container]"),l=document.querySelector("[data-project-title]"),o=document.querySelector("[data-tasks]"),c=document.getElementById("task-template"),s=document.querySelector("[data-clear-completed-tasks-button]"),r=document.querySelector("[data-new-task-button]"),i=document.querySelector("[data-cancel-task-btn]"),u=document.querySelector("[data-submit-task-btn]"),m=document.getElementById("task-form"),p=document.getElementById("todo-input"),y=document.querySelector("[data-edit-title-input]"),f=document.querySelector("[data-edit-details-input]"),k=document.querySelector("[data-edit-date-input]"),v=document.getElementById("todo-input-details"),S=document.getElementById("todo-input-date"),L=document.querySelectorAll("[data-close-button]"),E=document.getElementById("overlay"),h=document.getElementById("edit-task-form"),q=document.querySelector("[data-cancel-edit-task-btn]"),g=document.querySelector("[data-submit-edit-task-btn]"),b=document.querySelector("[data-starred-list]");function C(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function x(){C(e),A.forEach((t=>{r.classList.remove("hidden"),n.classList.remove("hidden");const a=document.createElement("li");a.dataset.projectId=t.id,a.classList.add("project-name"),a.innerText=t.name,t.id===O&&a.classList.add("active-project"),e.appendChild(a)}));const t=A.find((e=>e.id===O));null==O?d.style.display="none":(d.style.display="",l.innerText=t.name,C(o),function(e){e.tasks.forEach((e=>{const t=document.importNode(c.content,!0),a=t.querySelector("input");a.id=e.id,a.checked=e.complete;const n=t.querySelector("label");n.htmlFor=e.id;const d=t.querySelector("[data-details-space]");d.classList.add("hidden"),n.append(e.title),d.append(e.details);const l=t.querySelector("[data-date-space]");l.classList.add("hidden"),l.append(e.date),o.appendChild(t)}))}(t))}const I="task.projects",j="task.selectedProjectId";let A=JSON.parse(localStorage.getItem(I))||[],O=localStorage.getItem(j);function w(){localStorage.setItem(I,JSON.stringify(A)),localStorage.setItem(j,O),x()}function D(e,t,a,n){if(null==e)return;const d=e.querySelector("[data-popup-title]"),l=e.querySelector("[data-popup-body]"),o=e.querySelector("[data-popup-date]");d.textContent=t,l.textContent=a,o.textContent=n,e.classList.add("active"),E.classList.add("active")}function B(e){null!=e&&(e.classList.remove("active"),E.classList.remove("active"))}function N(){m.classList.add("hidden")}function M(e,t,a){return{id:Date.now().toString(),title:e,details:t,date:a,complete:!1,starred:!1}}function T(e){return{id:Date.now().toString(),name:e,tasks:[]}}document.addEventListener("DOMContentLoaded",(()=>{document.querySelectorAll("[data-popup-target]").forEach((e=>{e.addEventListener("click",(()=>{const t=e.closest(".task"),a=t.querySelector("[data-details-space]").textContent,n=t.querySelector("label").textContent,d=t.querySelector("[data-date-space]").textContent,l=document.querySelector("[data-date-key]");null==d||""===d?(l&&(l.textContent="No task date"),D(popup,n,a,d)):(l.textContent="(yyyy-mm-dd)",D(popup,n,a,d))}))}))})),E.addEventListener("click",(()=>{document.querySelectorAll(".popup.active").forEach((e=>{B(e)}))})),L.forEach((e=>{e.addEventListener("click",(()=>{B(e.closest(".popup"))}))})),i.addEventListener("click",(e=>{N()})),o.addEventListener("click",(e=>{"input"===e.target.tagName.toLowerCase()&&(A.find((e=>e.id===O)).tasks.find((t=>t.id===e.target.id)).complete=e.target.checked,w())})),e.addEventListener("click",(e=>{"li"===e.target.tagName.toLowerCase()&&(O=e.target.dataset.projectId,w())})),t.addEventListener("submit",(e=>{e.preventDefault();const t=a.value;if(null==t||""===t)return;const n=T(t);a.value=null,A.push(n),w()})),document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll("[data-edit-task-button]").forEach((e=>{e.addEventListener("click",(e=>{h.classList.remove("hidden")}))}))}));let J=null;function F(){h.classList.add("hidden")}q.addEventListener("click",(e=>{F()})),b.addEventListener("click",(()=>{console.log("Starred list clicked"),l.textContent="Starred",C(o),n.classList.add("hidden"),r.classList.add("hidden")})),s.addEventListener("click",(e=>{const t=A.find((e=>e.id===O));t.tasks=t.tasks.filter((e=>!e.complete)),w()})),n.addEventListener("click",(e=>{A=A.filter((e=>e.id!==O)),O=null,w()})),M(),r.addEventListener("click",(e=>{m.classList.remove("hidden"),h.classList.add("hidden")})),document.addEventListener("DOMContentLoaded",(()=>{document.querySelectorAll("[data-edit-task-button]").forEach((e=>{e.addEventListener("click",(()=>{N();const t=e.closest(".task"),a=t.querySelector("[data-details-space]").textContent,n=document.querySelector("[data-edit-details-input]"),d=t.querySelector("label").textContent.trim(),l=document.querySelector("[data-edit-title-input]"),o=t.querySelector("[data-date-space]").textContent;document.querySelector("[data-edit-date-input]").value=o,l.value=d,n.value=a,J=t}))}))})),g.addEventListener("click",(e=>{e.preventDefault();const t=y.value,a=f.value,n=k.value;if(null==t||""===t)alert("Enter a title for your task!");else if(t.length>20)alert("Task title is too long! Maximum title should be 20 characters.");else{const e=M(t,a,n),d=A.find((e=>e.id===O));if(J){const e=Array.from(J.parentElement.children).indexOf(J);d.tasks.splice(e,1)}d.tasks.push(e),J=null,w(),F()}})),x(),u.addEventListener("click",(e=>{e.preventDefault();let t=p.value,a=v.value,n=S.value;if(null==t||""===t)alert("Enter a title for your new task!");else if(t.length>20)alert("Task title is too long! Maximum title should be 20 characters.");else{const e=M(t,a,n);A.find((e=>e.id===O)).tasks.push(e),v.value=null,p.value=null,S.value=null,w(),N(),D(popup,t,a,n)}})),T(),w(),o.addEventListener("click",(e=>{if(e.target.matches("[data-delete-task-button]")){const t=e.target.parentElement,a=A.find((e=>e.id===O)),n=Array.from(t.parentElement.children).indexOf(t);a.tasks.splice(n,1),o.removeChild(t),F(),w()}})),o.addEventListener("click",(e=>{if(e.target.matches("[data-star-task-button]")){const t=e.target.parentElement,a=A.find((e=>e.id===O)),n=Array.from(t).indexOf(t);a.tasks.slice(n,1),e.target.style.display="none",t.querySelector("[data-full-star-button]").style.display="block",t.classList.add("starred"),console.log("Starred:",t)}else if(e.target.matches("[data-full-star-button]")){const t=e.target.parentElement,a=A.find((e=>e.id===O)),n=Array.from(t).indexOf(t);a.tasks.slice(n,1),e.target.style.display="none",t.querySelector("[data-star-task-button]").style.display="block",t.classList.remove("starred"),console.log("Unstarred:",t)}}))})();